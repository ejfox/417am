var Chance,GenArt,_,art,clColors,d3,options,path,seed;path=require("path"),d3=require("d3"),_=require("lodash"),seed=Date.now(),Chance=require("chance"),clColors=require("nice-color-palettes/500"),(art=new(GenArt=require("./GenArt"))(seed,options={count:24,numTicks:2400,bgColor:"white",fillColor:"white",opacity:1,randomizeCount:!1,randomizeTicks:!1,radius:48,minRadius:2,drawLinks:!1,constrainEdges:!0,colorChangeAmount:.9})).makeParticles=function(){var i,t,n,a,e,c,o,r;for(console.log("Making "+this.count+" particles"),this.colors=this.chance.pickone(clColors),this.data=d3.range(this.count).map(function(i){return function(t,n){var a,e,c,o,r;return r=i.chance.integer({min:50,max:120}),o={},o.x=i.chance.floating({min:-r,max:r}),o.y=i.chance.floating({min:-r,max:r}),0,i.height/2+o.y,e=i.chance.pickone(i.colors),a=d3.hsl(e),a.opacity=i.opacity,c={x:i.width/2,y:i.height/2,color:a.toString(),radius:i.radius,opacity:i.opacity},1===n&&(c.radius=i.chance.integer({min:50,max:150})),n%25>=1&&(c.x=.2*i.width,c.y=i.height/2),c}}(this)),this.links=d3.range(this.count*this.chance.floating({min:.1,max:10})).map(function(i){return function(){return{source:i.chance.integer({min:0,max:i.count-1}),target:i.chance.integer({min:0,max:i.count-1})}}}(this)),e=c=0,o=this.data.length-1;0<=o?c<=o:c>=o;e=0<=o?++c:--c)this.links.push({source:1,target:e});return i=this.chance.floating({min:.05,max:.25}),r=this.chance.floating({min:.01,max:.25}),a=this.chance.floating({min:-30,max:30}),t=this.chance.floating({min:.35,max:1.25}),n=this.chance.floating({min:.35,max:1.25}),this.simulation=d3.forceSimulation(this.data).alphaDecay(i).velocityDecay(r).force("charge",d3.forceManyBody().strength(a)).force("collide",d3.forceCollide(function(i){return 1.2*i.radius}).iterations(8)).force("link",d3.forceLink(this.links).distance(10).strength(.5)).force("center",d3.forceCenter(this.width/2*t,this.height/2*n)),this.data},art.tick=function(){var i;for(this.ticks||0,this.ticks++,i=0;i<=2;++i)this.simulation.tick();return this.drawLinks&&this.chance.bool({likelihood:5})&&this.links.forEach(function(i){return function(t,n){var a;return a=i.chance.floating({min:0,max:.8}),i.ctx.beginPath(),i.ctx.moveTo(t.source.x,t.source.y),i.ctx.lineTo(t.target.x,t.target.y),i.ctx.strokeStyle="rgba(255,255,255,"+a+")",i.ctx.stroke()}}(this)),this.data.forEach(function(i){return function(t,n){var a,e,c,o;return o=.25*i.simplex.noise2D(t.x,t.y),c=.25*t.radius,i.chance.bool({likelihood:15})?t.vx+=.5:i.chance.bool({likelihood:15})&&(t.vx+=.5),i.chance.bool({likelihood:25})&&(t.x+=i.chance.floating({min:-c,max:c})),i.chance.bool({likelihood:25})&&(t.y+=i.chance.floating({min:-c,max:c})),1===n&&(t.opacity=0,i.chance.bool({likelihood:70})&&(t.x+=i.chance.integer({min:-2,max:7}))),i.constrainEdges&&(t.x=_.clamp(t.x,0+t.radius,i.width-t.radius),t.y=_.clamp(t.y,0+t.radius,i.height-t.radius)),o>0?(t.x+=i.chance.floating({min:-6,max:6}),t.radius-=.66*o):(t.y+=i.chance.floating({min:-6,max:6}),t.radius+=.05*o),t.radius=_.clamp(t.radius,1,200),e=.64*(t.vy+t.vx),a=d3.hsl(t.color),a.h+=e,a.opacity=t.opacity,t.color=a.toString(),i.ctx.beginPath(),i.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),i.ctx.fillStyle=t.color,1!==n&&i.ctx.fill(),i.ctx.closePath()}}(this)),this.limitTicks?this.ticks<this.numTicks?requestAnimationFrame(this.tick.bind(this)):this.limitTicks&&this.ticks===this.numTicks?cancelAnimationFrame(this.rafAnimation):void 0:requestAnimationFrame(this.tick.bind(this))},module.exports=art;