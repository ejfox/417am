var Chance,GenArt,_,art,clColors,d3,deg2rad,options,seed;d3=require("d3"),seed=Date.now(),_=require("lodash"),clColors=require("nice-color-palettes/100"),deg2rad=Math.PI/180,Chance=require("chance"),(art=new(GenArt=require("./GenArt"))(seed,options={count:2,randomizeCount:!1,numTicks:55555,randomizeTicks:!1,bgColor:"white",fillColor:"black",constrainEdges:!0,opacity:.8})).makeParticles=function(){return this.chance=new Chance(+new Date),this.ctx.globalCompositeOperation="multiply",this.opacity=this.chance.floating({min:.5,max:1}),this.colors=this.chance.pickone(clColors),this.colors=this.chance.pickset(this.colors,this.chance.integer({min:2,max:4})),console.log("Making "+this.count+" particles"),this.data=d3.range(this.count).map(function(e){return function(){var i,n,t,a,c;return t=e.chance.integer({min:25,max:e.width}),n={},n.x=e.chance.floating({min:-t,max:t}),n.y=e.chance.floating({min:-t,max:t}),a=e.width/2+n.x,c=e.height/2+n.y,a=_.clamp(a,0,e.width),c=_.clamp(c,0,e.height),i=d3.hsl(e.chance.pickone(e.colors)),i.opacity=e.opacity,{x:e.width/2,y:e.height/2,color:i.toString(),angle:0,angleStep:e.chance.floating({min:-8,max:8}),angleClamp:e.chance.bool(),noise:e.chance.floating({min:.001,max:.8}),hueNoise:e.chance.bool()}}}(this)),this.data},art.tick=function(){var e;return e=this.chance.integer({min:1,max:20}),this.data.forEach(function(i){return function(n,t){var a,c;return c=.25*i.simplex.noise2D(n.x,n.y),i.chance.bool({likelihood:20})&&(n.angleStep+=c*i.chance.floating({min:.001,max:12})),i.chance.bool({likelihood:.25*i.ticks})&&(n.angleStep-=c*i.chance.floating({min:1,max:22})),0===n.x?n.angle=i.chance.integer({min:90,max:360}):n.x===i.width?n.angle=i.chance.integer({min:90,max:360}):0===n.y?n.angle=i.chance.integer({min:0,max:180}):n.y===i.height&&(n.angle=i.chance.integer({min:180,max:360})),n.x=n.x+Math.cos(n.angle*deg2rad),n.y=n.y+Math.sin(n.angle*deg2rad),n.angle+=n.angleStep,n.angleClamp?n.angleStep=_.clamp(n.angleStep,-2,2):n.angleStep=_.clamp(n.angleStep,-e,e),n.angle>360&&(n.angle=0),i.constrainEdges&&(n.x=_.clamp(n.x,0,i.width),n.y=_.clamp(n.y,0,i.height)),i.ctx.beginPath(),1,i.ctx.rect(n.x,n.y,1,1),a=d3.hsl(n.color),a.h+=.12,n.hueNoise&&(a.h+=c*(.01*n.angle)),a.s+=c*n.noise,a.l+=c*n.noise,n.color=a.toString(),i.ctx.fillStyle=n.color,i.ctx.fill(),i.ctx.closePath()}}(this)),this.limitTicks?this.ticks<this.numTicks?requestAnimationFrame(this.tick.bind(this)):this.limitTicks&&this.ticks===this.numTicks?cancelAnimationFrame(this.rafAnimation):void 0:requestAnimationFrame(this.tick.bind(this))},module.exports=art;